{"conceptual":"\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"3\" sourceendlinenumber=\"3\">When writing to a stream you often want to use <code>Expected Version</code> to allow for optimistic concurrency with a stream.</p>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"5\" sourceendlinenumber=\"5\">i.e. my write can succeed if I have seen everyone else&#39;s writes.</p>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"7\" sourceendlinenumber=\"7\">You most commonly use this for a domain object projection, You can set <code>ExpectedVersion</code> as <code>ES-ExpectedVersion: #</code>.</p>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"9\" sourceendlinenumber=\"9\">By default the <code>ES-ExpectedVersion</code> is <code>-2</code> (append). You can set an actual version number as well or <code>-1</code> to say that the stream should not exist when processing (e.g. you expect to be creating it), or <code>-4</code> to say that the stream should exist with any number of events in it.</p>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"11\" sourceendlinenumber=\"11\">If the <code>ExpectedVersion</code> does not match the version of the stream, Event Store will return an HTTP 400 <code>Wrong expected EventNumber</code> response. This response contains the current version of the stream in an <code>ES-CurrentVersion</code> header.</p>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"13\" sourceendlinenumber=\"13\">In the following cURL command <code>ExpectedVersion</code> is not set (and it will append or create/append to the stream).</p>\n<div class=\"tabGroup\" id=\"tabgroup_aBQ1I+q7tV\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"15\" sourceendlinenumber=\"35\">\n<ul role=\"tablist\">\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV_tabid-1\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV_tabid-1\" data-tab=\"tabid-1\" tabindex=\"0\" aria-selected=\"true\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"15\" sourceendlinenumber=\"15\">Request</a>\n</li>\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV_tabid-2\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV_tabid-2\" data-tab=\"tabid-2\" tabindex=\"-1\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"21\" sourceendlinenumber=\"21\">Response</a>\n</li>\n</ul>\n<section id=\"tabpanel_aBQ1I+q7tV_tabid-1\" role=\"tabpanel\" data-tab=\"tabid-1\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"17\" sourceendlinenumber=\"19\"><code class=\"lang-bash\">curl -i -d @event.js &quot;http://127.0.0.1:2113/streams/newstream&quot; -H &quot;Content-Type:application/json&quot;\n</code></pre></section>\n<section id=\"tabpanel_aBQ1I+q7tV_tabid-2\" role=\"tabpanel\" data-tab=\"tabid-2\" aria-hidden=\"true\" hidden=\"hidden\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"23\" sourceendlinenumber=\"34\"><code class=\"lang-http\">HTTP/1.1 201 Created\nAccess-Control-Allow-Methods: POST, DELETE, GET, OPTIONS\nAccess-Control-Allow-Headers: Content-Type, X-Requested-With, X-PINGOTHER\nAccess-Control-Allow-Origin: *\nLocation: http://127.0.0.1:2113/streams/newstream/0\nContent-Type: text/plain; charset: utf-8\nServer: Mono-HTTPAPI/1.0\nDate: Thu, 27 Jun 2013 14:26:14 GMT\nContent-Length: 0\nKeep-Alive: timeout=15,max=100\n</code></pre></section>\n</div>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"37\" sourceendlinenumber=\"37\">The stream &#39;newstream&#39; now has one event. If appending with an expected version of &#39;3&#39; this will not work.</p>\n<div class=\"tabGroup\" id=\"tabgroup_aBQ1I+q7tV-1\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"39\" sourceendlinenumber=\"59\">\n<ul role=\"tablist\">\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV-1_tabid-3\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV-1_tabid-3\" data-tab=\"tabid-3\" tabindex=\"0\" aria-selected=\"true\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"39\" sourceendlinenumber=\"39\">Request</a>\n</li>\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV-1_tabid-4\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV-1_tabid-4\" data-tab=\"tabid-4\" tabindex=\"-1\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"45\" sourceendlinenumber=\"45\">Response</a>\n</li>\n</ul>\n<section id=\"tabpanel_aBQ1I+q7tV-1_tabid-3\" role=\"tabpanel\" data-tab=\"tabid-3\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"41\" sourceendlinenumber=\"43\"><code class=\"lang-bash\">curl -i -d @event.js &quot;http://127.0.0.1:2113/streams/newstream&quot; -H &quot;Content-Type:application/json&quot; -H &quot;ES-ExpectedVersion: 3&quot;\n</code></pre></section>\n<section id=\"tabpanel_aBQ1I+q7tV-1_tabid-4\" role=\"tabpanel\" data-tab=\"tabid-4\" aria-hidden=\"true\" hidden=\"hidden\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"47\" sourceendlinenumber=\"58\"><code class=\"lang-http\">HTTP/1.1 400 Wrong expected EventNumber\nAccess-Control-Allow-Methods: POST, DELETE, GET, OPTIONS\nAccess-Control-Allow-Headers: Content-Type, X-Requested-With, X-PINGOTHER\nAccess-Control-Allow-Origin: *\nES-CurrentVersion: 0\nContent-Type: text/plain; charset: utf-8\nServer: Mono-HTTPAPI/1.0\nDate: Thu, 27 Jun 2013 14:27:24 GMT\nContent-Length: 0\nConnection: close\n</code></pre></section>\n</div>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"61\" sourceendlinenumber=\"61\">You can see from the <code>ES-CurrentVersion</code> header above that the stream is at version zero. Appending with an expected version of zero will work. The expected version is always the version of the last event you know of in the stream.</p>\n<div class=\"tabGroup\" id=\"tabgroup_aBQ1I+q7tV-2\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"63\" sourceendlinenumber=\"83\">\n<ul role=\"tablist\">\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV-2_tabid-5\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV-2_tabid-5\" data-tab=\"tabid-5\" tabindex=\"0\" aria-selected=\"true\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"63\" sourceendlinenumber=\"63\">Request</a>\n</li>\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV-2_tabid-6\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV-2_tabid-6\" data-tab=\"tabid-6\" tabindex=\"-1\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"69\" sourceendlinenumber=\"69\">Response</a>\n</li>\n</ul>\n<section id=\"tabpanel_aBQ1I+q7tV-2_tabid-5\" role=\"tabpanel\" data-tab=\"tabid-5\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"65\" sourceendlinenumber=\"67\"><code class=\"lang-bash\">curl -i -d @event.js &quot;http://127.0.0.1:2113/streams/newstream&quot; -H &quot;Content-Type:application/json&quot; -H &quot;ES-ExpectedVersion: 0&quot;\n</code></pre></section>\n<section id=\"tabpanel_aBQ1I+q7tV-2_tabid-6\" role=\"tabpanel\" data-tab=\"tabid-6\" aria-hidden=\"true\" hidden=\"hidden\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"71\" sourceendlinenumber=\"82\"><code class=\"lang-http\">HTTP/1.1 201 Created\nAccess-Control-Allow-Methods: POST, DELETE, GET, OPTIONS\nAccess-Control-Allow-Headers: Content-Type, X-Requested-With, X-PINGOTHER\nAccess-Control-Allow-Origin: *\nLocation: http://127.0.0.1:2113/streams/newstream/1\nContent-Type: text/plain; charset: utf-8\nServer: Mono-HTTPAPI/1.0\nDate: Thu, 27 Jun 2013 14:47:10 GMT\nContent-Length: 0\nKeep-Alive: timeout=15,max=100\n</code></pre></section>\n</div>\n","type":"Conceptual","source":{"remote":{"path":"http-api/optional-http-headers/expected-version.md","branch":"swagger-docfx","repo":"git@github.com:EventStore/docs.geteventstore.com.git"},"startLine":0,"endLine":0,"isExternal":false},"path":"http-api/optional-http-headers/expected-version.md","documentation":{"remote":{"path":"http-api/optional-http-headers/expected-version.md","branch":"swagger-docfx","repo":"git@github.com:EventStore/docs.geteventstore.com.git"},"startLine":0,"endLine":0,"isExternal":false},"_docfxVersion":"2.31.0.0","_systemKeys":["conceptual","type","source","path","documentation","title","rawTitle","wordCount"],"title":"Optional HTTP Headers: Expected Version","rawTitle":"<h1 id=\"optional-http-headers-expected-version\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"1\" sourceendlinenumber=\"1\">Optional HTTP Headers: Expected Version</h1>","wordCount":347,"_lang":"csharp","_tocPath":"docs/toc.html","_rel":"../../../","_path":"docs/http-api/optional-http-headers/expected-version.html","_key":"http-api/optional-http-headers/expected-version.md","_tocRel":"../../toc.html","_tocKey":"~/toc.md","__global":{"classesInSubtitle":"Classes","structsInSubtitle":"Structs","interfacesInSubtitle":"Interfaces","enumsInSubtitle":"Enums","delegatesInSubtitle":"Delegates","constructorsInSubtitle":"Constructors","fieldsInSubtitle":"Fields","propertiesInSubtitle":"Properties","methodsInSubtitle":"Methods","eventsInSubtitle":"Events","operatorsInSubtitle":"Operators","eiisInSubtitle":"Explicit Interface Implementations","functionsInSubtitle":"Functions","membersInSubtitle":"Members","improveThisDoc":"Improve this Doc","viewSource":"View Source","inheritance":"Inheritance","inheritedMembers":"Inherited Members","namespace":"Namespace","assembly":"Assembly","syntax":"Syntax","overrides":"Overrides","implements":"Implements","remarks":"Remarks","examples":"Examples","seealso":"See Also","declaration":"Declaration","parameters":"Parameters","typeParameters":"Type Parameters","type":"Type","name":"Name","description":"Description","returns":"Returns","fieldValue":"Field Value","propertyValue":"Property Value","eventType":"Event Type","exceptions":"Exceptions","condition":"Condition","extensionMethods":"Extension Methods","note":"<h5>Note</h5>","warning":"<h5>Warning</h5>","tip":"<h5>Tip</h5>","important":"<h5>Important</h5>","caution":"<h5>Caution</h5>","_shared":{}}}