{"conceptual":"\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"3\" sourceendlinenumber=\"3\">The clustering code for Event Store is open source under the BSD-3 license as the rest of the code. This guide will look at how you can setup a highly available cluster using the open source components.</p>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"5\" sourceendlinenumber=\"5\">When setting up a cluster, you generally want an odd number of nodes as Event Store uses a quorum based algorithm to handle high availability.</p>\n<h2 id=\"running-on-the-same-machine\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"7\" sourceendlinenumber=\"7\">Running on the Same Machine</h2>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"9\" sourceendlinenumber=\"9\">To start, you will set up three nodes running on a single machine. Run each of the commands below in its own console window, remember that you either need admin privileges or have setup ACLs with IIS if running under Windows (Unix-like operating systems need no configuration). Replace &quot;127.0.0.1&quot; with whatever IP address you want to run on.</p>\n<div class=\"WARNING\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"11\" sourceendlinenumber=\"11\"><h5>Warning</h5><p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"12\" sourceendlinenumber=\"12\">This must be an interface present on the machine.</p>\n</div>\n<pre sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"14\" sourceendlinenumber=\"18\"><code class=\"lang-powershell\">start EventStore.ClusterNode.exe --mem-db --log .\\logs\\log1 --int-ip 127.0.0.1 --ext-ip 127.0.0.1 --int-tcp-port=1111 --ext-tcp-port=1112 --int-http-port=1113 --ext-http-port=1114 --cluster-size=3 --discover-via-dns=false --gossip-seed=127.0.0.1:2113,127.0.0.1:3113\nstart EventStore.ClusterNode.exe --mem-db --log .\\logs\\log2 --int-ip 127.0.0.1 --ext-ip 127.0.0.1 --int-tcp-port=2111 --ext-tcp-port=2112 --int-http-port=2113 --ext-http-port=2114 --cluster-size=3 --discover-via-dns=false --gossip-seed=127.0.0.1:1113,127.0.0.1:3113\nstart EventStore.ClusterNode.exe --mem-db --log .\\logs\\log3 --int-ip 127.0.0.1 --ext-ip 127.0.0.1 --int-tcp-port=3111 --ext-tcp-port=3112 --int-http-port=3113 --ext-http-port=3114 --cluster-size=3 --discover-via-dns=false --gossip-seed=127.0.0.1:1113,127.0.0.1:2113\n</code></pre><p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"20\" sourceendlinenumber=\"20\">You should now have three nodes running together in a cluster. If you kill one of the nodes, it will continue running. This binds to the loopback interface. To access Event Store from outside your machine, specify a different IP address for the <code>--ext-ip</code> parameter.</p>\n<h2 id=\"running-on-separate-machines\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"22\" sourceendlinenumber=\"22\">Running on Separate Machines</h2>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"24\" sourceendlinenumber=\"24\">Most importantly is understanding the &quot;gossip seeds&quot;. You are instructing seed locations for when the node first starts and needs to begin gossiping. Any node can be a seed. By giving each node the other nodes you ensure that there will always be another node to gossip with if a quorum can be built. If you wanted to move this to run on three machines you would change the IPs on the command line to something such as:</p>\n<pre sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"26\" sourceendlinenumber=\"30\"><code class=\"lang-powershell\">EventStore.ClusterNode.exe --mem-db --log c:\\dbs\\cluster\\log1 --int-ip 192.168.0.1 --ext-ip 192.168.0.1 --int-tcp-port=1111 --ext-tcp-port=1112 --int-http-port=2113 --ext-http-port=2114 --cluster-size=3 --discover-via-dns=false --gossip-seed=192.168.0.2:2113,192.168.0.3:2113\nEventStore.ClusterNode.exe --mem-db --log c:\\dbs\\cluster\\log2 --int-ip 192.168.0.2 --ext-ip 192.168.0.2 --int-tcp-port=1111 --ext-tcp-port=1112 --int-http-port=2113 --ext-http-port=2114 --cluster-size=3 --discover-via-dns=false --gossip-seed=192.168.0.1:2113,192.168.0.3:2113\nEventStore.ClusterNode.exe --mem-db --log c:\\dbs\\cluster\\log3 --int-ip 192.168.0.3 --ext-ip 192.168.0.3 --int-tcp-port=1111 --ext-tcp-port=1112 --int-http-port=2113 --ext-http-port=2114 --cluster-size=3 --discover-via-dns=false --gossip-seed=192.168.0.1:2113,192.168.0.2:2113\n</code></pre><h2 id=\"using-dns\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"32\" sourceendlinenumber=\"32\">Using DNS</h2>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"34\" sourceendlinenumber=\"34\">Entering the commands above into each node is tedious and error-prone (especially as the replica set counts go up). Another configuration option is to create a DNS entry that points to all the nodes in the cluster and then specifying that DNS entry on the command line along with the appropriate port</p>\n<pre sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"36\" sourceendlinenumber=\"40\"><code class=\"lang-powershell\">EventStore.ClusterNode.exe --log c:\\dbs\\cluster\\log1 --int-ip 192.168.0.1 --ext-ip 192.168.0.1 --int-tcp-port=1111 --ext-tcp-port=1112 --int-http-port=2113 --ext-http-port=2114 --cluster-size=3 --cluster-dns mydomain.com --cluster-gossip-port=2113\nEventStore.ClusterNode.exe --mem-db --log c:\\dbs\\cluster\\log2 --int-ip 192.168.0.2 --ext-ip 192.168.0.2 --int-tcp-port=1111 --ext-tcp-port=1112 --int-http-port=2113 --ext-http-port=2114 --cluster-size=3 --cluster-dns mydomain.com --cluster-gossip-port=2113\nEventStore.ClusterNode.exe --mem-db --log c:\\dbs\\cluster\\log3 --int-ip 192.168.0.3 --ext-ip 192.168.0.3 --int-tcp-port=1111 --ext-tcp-port=1112 --int-http-port=2113 --ext-http-port=2114 --cluster-size=3 --cluster-dns mydomain.com --cluster-gossip-port=2113\n</code></pre><div class=\"WARNING\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"42\" sourceendlinenumber=\"42\"><h5>Warning</h5><p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"43\" sourceendlinenumber=\"43\">This method is also good for HTTP clients as you can avoid using a load balancer and fall back to round robin DNS for many deployments.</p>\n</div>\n<h2 id=\"internal-vs-external\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"45\" sourceendlinenumber=\"45\">Internal vs. External</h2>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"47\" sourceendlinenumber=\"47\">All communications in Event Store are optionally segregated to different networks. Internal networks for tasks like replication and external for talking to clients. You can place these communications on segregated networks if you wish and it is often a good idea to do so both for performance and security purposes.</p>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"49\" sourceendlinenumber=\"49\">To setup an internal network all the command line parameters provided above have <code>int-</code> options. All communications channels also support the enabling of SSL for the connections.</p>\n<h2 id=\"http-clients\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"51\" sourceendlinenumber=\"51\">HTTP Clients</h2>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"53\" sourceendlinenumber=\"53\">If you want to use the HTTP API, then you would add a load balancer in front of the three nodes. It does not matter which node receives a request as the requests the node will forward the request internally. With this setup, you can lose any one machine with an easy setup. <!-- TODO: What does this mean? Better wording --></p>\n<h2 id=\"native-tcp-clients\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"55\" sourceendlinenumber=\"55\">Native TCP Clients</h2>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"57\" sourceendlinenumber=\"57\">You can also connect to the cluster using the native TCP interface. The client APIs support switching between nodes internally. As such if you have a master failover the connection will automatically failover and handle retries to another node.</p>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"59\" sourceendlinenumber=\"59\">To set up a connection as above, in the command line you provide gossip seeds to the connection. The client will use the gossip seeds to begin gossiping information about the cluster.</p>\n<pre sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"61\" sourceendlinenumber=\"72\"><code class=\"lang-csharp\">EventStoreConnection.Create(\n        ConnectionSettings.Create().KeepReconnecting(),\n        ClusterSettings.Create()\n        .WithGossipTimeoutOf(TimeSpan.FromMilliseconds(500))\n        .WithGossipSeeds(new []\n{\n        new IPEndPoint(IPAddress.Parse(&quot;192.168.0.1&quot;), 2113),\n        new IPEndPoint(IPAddress.Parse(&quot;192.168.0.2&quot;), 2113),\n        new IPEndPoint(IPAddress.Parse(&quot;192.168.0.3&quot;), 2113)\n}));\n</code></pre><p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"74\" sourceendlinenumber=\"74\">As in the example above, you can also use DNS to avoid manually specifying the seeds. You add the nodes to a DNS record and then specify that DNS entry to the connection to locate nodes.</p>\n<pre sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"76\" sourceendlinenumber=\"82\"><code class=\"lang-csharp\">EventStoreConnection.Create(ConnectionSettings.Create()\n                            .KeepReconnecting(),\n                            ClusterSettings.Create()\n                            .SetClusterDns(&quot;mycluster.com&quot;))\n.SetGossipPort(2113)\n</code></pre><div class=\"TIP\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"84\" sourceendlinenumber=\"84\"><h5>Tip</h5><p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"85\" sourceendlinenumber=\"85\">For those using the closed source version <code>GossipPort</code> is an alias for <code>ManagerPort</code> as the closed source version includes a node manager on each physical node. This allows for controlling many virtual nodes on a machine with easy configuration. The manager also acts as a supervisor for the nodes.</p>\n</div>\n<p sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"87\" sourceendlinenumber=\"87\">As mentioned the connection will automatically reconnect during node failures. You can control this behaviour with options on the <code>ConnectionSettings</code> such as limiting retry attempts or frequency. The connection and durable subscription will even manage a subscription during node failures, you will not even receive duplicated messages over your durable subscription.</p>\n","type":"Conceptual","source":{"remote":{"path":"server/cluster-without-manager-nodes.md","branch":"swagger-docfx","repo":"git@github.com:EventStore/docs.geteventstore.com.git"},"startLine":0,"endLine":0,"isExternal":false},"path":"server/cluster-without-manager-nodes.md","documentation":{"remote":{"path":"server/cluster-without-manager-nodes.md","branch":"swagger-docfx","repo":"git@github.com:EventStore/docs.geteventstore.com.git"},"startLine":0,"endLine":0,"isExternal":false},"_docfxVersion":"2.31.0.0","_systemKeys":["conceptual","type","source","path","documentation","title","rawTitle","wordCount"],"title":"Setting up a Cluster using only Database Nodes (OSS)","rawTitle":"<h1 id=\"setting-up-a-cluster-using-only-database-nodes-oss\" sourcefile=\"server/cluster-without-manager-nodes.md\" sourcestartlinenumber=\"1\" sourceendlinenumber=\"1\">Setting up a Cluster using only Database Nodes (OSS)</h1>","wordCount":859,"_lang":"csharp","_tocPath":"docs/toc.html","_rel":"../../","_path":"docs/server/cluster-without-manager-nodes.html","_key":"server/cluster-without-manager-nodes.md","_tocRel":"../toc.html","_tocKey":"~/toc.md","__global":{"classesInSubtitle":"Classes","structsInSubtitle":"Structs","interfacesInSubtitle":"Interfaces","enumsInSubtitle":"Enums","delegatesInSubtitle":"Delegates","constructorsInSubtitle":"Constructors","fieldsInSubtitle":"Fields","propertiesInSubtitle":"Properties","methodsInSubtitle":"Methods","eventsInSubtitle":"Events","operatorsInSubtitle":"Operators","eiisInSubtitle":"Explicit Interface Implementations","functionsInSubtitle":"Functions","membersInSubtitle":"Members","improveThisDoc":"Improve this Doc","viewSource":"View Source","inheritance":"Inheritance","inheritedMembers":"Inherited Members","namespace":"Namespace","assembly":"Assembly","syntax":"Syntax","overrides":"Overrides","implements":"Implements","remarks":"Remarks","examples":"Examples","seealso":"See Also","declaration":"Declaration","parameters":"Parameters","typeParameters":"Type Parameters","type":"Type","name":"Name","description":"Description","returns":"Returns","fieldValue":"Field Value","propertyValue":"Property Value","eventType":"Event Type","exceptions":"Exceptions","condition":"Condition","extensionMethods":"Extension Methods","note":"<h5>Note</h5>","warning":"<h5>Warning</h5>","tip":"<h5>Tip</h5>","important":"<h5>Important</h5>","caution":"<h5>Caution</h5>","_shared":{}}}